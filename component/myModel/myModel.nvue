<template>
	<view class="model" v-if="isVisible">
		<!-- 蒙版 -->
		<view :class="isMaskOpacity ? 'model_cover_dark' : 'model_cover'" v-if="isShowMask" @click="hide"></view>
		<!-- 主要内容 -->
		<view ref="model" :class="isBottom ? 'model_bottom' : 'model_content'" :style="getModelContentStyle">
			<slot></slot>
		</view>
	</view>
</template>

<script>
	import Constant from '../../constant/js/const.js';
	export default {
		props: {
			// 是否展示蒙版
			isShowMask: { type: Boolean, default: true },
			// 是否将蒙版设置成透明
			isMaskOpacity: { type: Boolean, default: false },
			// 是否内容展示在底部
			isBottom: { type: Boolean, default: false },
			// 内容的背景颜色
			bodyBgColor: { type: String, default: Constant.boxWhiteBgColor },
			// 弹出层内容宽度
			bodyWidth:{ type:Number, default:0 },
			// 弹出层内容高度
			bodyHeight:{ type:Number, default:0 },
		},
		
		computed: {
			getModelContentStyle() {
				const left = this.x > -1 ? `${this.x}px` : ''
				const top = this.y > -1 ? `${this.y}px` : ''
				return `
					background-color: ${this.bodyBgColor};
					left: ${left};
					top: ${top};
				`
			}
		},
		data() {
			return {
				isVisible: false,
				maxX: 0,
				maxY: 0,
				x: -1,
				y: 1
			}
		},
		
		mounted() {
			const deviceInfo = uni.getSystemInfoSync()
			this.maxX = deviceInfo.windowWidth - uni.upx2px(this.bodyWidth) 
			this.maxY = deviceInfo.windowHeight - uni.upx2px(this.bodyHeight) 
		},
		methods: {
			show(x=-1, y=-1) {
				this.isVisible = true
				this.x = x > this.maxX ? this.maxX : x
				this.y = y > this.maxY ? this.maxY : y
			},
			hide() {
				this.isVisible = false
			}
		}
	}
</script>

<style lang="scss" scoped>
@import "@/constant/css/constant.scss";
.model {
	z-index: 9999;
}
.model_cover {
	width: 750rpx;
	@include fixed;
	background-color: rgba(0, 0, 0, 0.5);
}
.model_cover_dark {
	width: 750rpx;
	@include fixed;
	background-color: rgba(0, 0, 0, 0);
}
.model_content {
	position: fixed;
	background-color: #fff;
	border-radius: 10rpx;
}
.model_bottom {
	@include fixed;
	top: auto;
	width: $boxWidth;
}
</style>
